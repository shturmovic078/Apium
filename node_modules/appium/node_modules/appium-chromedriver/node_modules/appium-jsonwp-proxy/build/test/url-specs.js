require('source-map-support').install();

/* global describe:true, it:true */

'use strict';

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _ = require('../..');

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

//import Q from 'q';

require('mochawait');

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('proxying full urls', function () {
  it('should translate host and port', function () {
    var incomingUrl = 'http://127.0.0.2:4723/wd/hub/status';
    var j = new _.JWProxy();
    var proxyUrl = j.getUrlForProxy(incomingUrl);
    proxyUrl.should.equal('http://localhost:4444/wd/hub/status');
  });
  it('should translate the scheme', function () {
    var incomingUrl = 'http://127.0.0.2:4723/wd/hub/status';
    var j = new _.JWProxy({ scheme: 'HTTPS' });
    var proxyUrl = j.getUrlForProxy(incomingUrl);
    proxyUrl.should.equal('https://localhost:4444/wd/hub/status');
  });
  it('should translate the base', function () {
    var incomingUrl = 'http://127.0.0.2:4723/wd/hub/status';
    var j = new _.JWProxy({ base: '' });
    var proxyUrl = j.getUrlForProxy(incomingUrl);
    proxyUrl.should.equal('http://localhost:4444/status');
  });
  it('should translate the session id', function () {
    var incomingUrl = 'http://127.0.0.2:4723/wd/hub/session/foobar/element';
    var j = new _.JWProxy({ sessionId: 'barbaz' });
    var proxyUrl = j.getUrlForProxy(incomingUrl);
    proxyUrl.should.equal('http://localhost:4444/wd/hub/session/barbaz/element');
  });
  it('should error when translating session commands without session id', function () {
    var incomingUrl = 'http://127.0.0.2:4723/wd/hub/session/foobar/element';
    var j = new _.JWProxy();
    (function () {
      j.getUrlForProxy(incomingUrl);
    }).should['throw']('session id');
  });
});

describe('proxying partial urls', function () {
  it('should proxy /status', function () {
    var incomingUrl = '/status';
    var j = new _.JWProxy();
    var proxyUrl = j.getUrlForProxy(incomingUrl);
    proxyUrl.should.equal('http://localhost:4444/wd/hub/status');
  });
  it('should proxy /session', function () {
    var incomingUrl = '/session';
    var j = new _.JWProxy();
    var proxyUrl = j.getUrlForProxy(incomingUrl);
    proxyUrl.should.equal('http://localhost:4444/wd/hub/session');
  });
  it('should proxy /sessions', function () {
    var incomingUrl = '/sessions';
    var j = new _.JWProxy();
    var proxyUrl = j.getUrlForProxy(incomingUrl);
    proxyUrl.should.equal('http://localhost:4444/wd/hub/sessions');
  });
  it('should proxy session commands based off /session', function () {
    var incomingUrl = '/session/foobar/element';
    var j = new _.JWProxy({ sessionId: 'barbaz' });
    var proxyUrl = j.getUrlForProxy(incomingUrl);
    proxyUrl.should.equal('http://localhost:4444/wd/hub/session/barbaz/element');
  });
  it('should error session commands based off /session without session id', function () {
    var incomingUrl = '/session/foobar/element';
    var j = new _.JWProxy();
    (function () {
      j.getUrlForProxy(incomingUrl);
    }).should['throw']('session id');
  });
  it('should proxy session commands based off /wd/hub', function () {
    var incomingUrl = '/wd/hub/session/3d001db2-7987-42a7-975d-8d5d5304083f/timeouts/implicit_wait';
    var j = new _.JWProxy({ sessionId: '123' });
    var proxyUrl = j.getUrlForProxy(incomingUrl);
    proxyUrl.should.equal('http://localhost:4444/wd/hub/session/123/timeouts/implicit_wait');
  });
  it('should proxy session commands based off /session as ""', function () {
    var incomingUrl = '';
    var j = new _.JWProxy();
    (function () {
      j.getUrlForProxy(incomingUrl);
    }).should['throw']('session id');
    j = new _.JWProxy({ sessionId: '123' });
    var proxyUrl = j.getUrlForProxy(incomingUrl);
    proxyUrl.should.equal('http://localhost:4444/wd/hub/session/123');
  });
  it('should proxy session commands without /session', function () {
    var incomingUrl = '/element';
    var j = new _.JWProxy({ sessionId: 'barbaz' });
    var proxyUrl = j.getUrlForProxy(incomingUrl);
    proxyUrl.should.equal('http://localhost:4444/wd/hub/session/barbaz/element');
  });
  it('should error session commands without /session without session id', function () {
    var incomingUrl = '/element';
    var j = new _.JWProxy();
    (function () {
      j.getUrlForProxy(incomingUrl);
    }).should['throw']('session id');
  });
});
//# sourceMappingURL=data:application/json;base64,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Q0FBQztHQUM5RSxDQUFDLENBQUM7QUFDSCxJQUFFLENBQUMsbUVBQW1FLEVBQUUsWUFBTTtBQUM1RSxRQUFJLFdBQVcsR0FBRyxVQUFVLENBQUM7QUFDN0IsUUFBSSxDQUFDLEdBQUcsTUE5RkgsT0FBTyxFQThGUyxDQUFDO0FBQ3RCLEtBQUMsWUFBTTtBQUFFLE9BQUMsQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLENBQUM7S0FBRSxDQUFBLENBQUUsTUFBTSxTQUFNLENBQUMsWUFBWSxDQUFDLENBQUM7R0FDdkUsQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3QvdXJsLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gdHJhbnNwaWxlOm1vY2hhXG4vKiBnbG9iYWwgZGVzY3JpYmU6dHJ1ZSwgaXQ6dHJ1ZSAqL1xuXG5pbXBvcnQgeyBKV1Byb3h5IH0gZnJvbSAnLi4vLi4nO1xuaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG4vL2ltcG9ydCBRIGZyb20gJ3EnO1xuaW1wb3J0ICdtb2NoYXdhaXQnO1xuXG5jaGFpLnNob3VsZCgpO1xuY2hhaS51c2UoY2hhaUFzUHJvbWlzZWQpO1xuXG5kZXNjcmliZSgncHJveHlpbmcgZnVsbCB1cmxzJywgKCkgPT4ge1xuICBpdCgnc2hvdWxkIHRyYW5zbGF0ZSBob3N0IGFuZCBwb3J0JywgKCkgPT4ge1xuICAgIGxldCBpbmNvbWluZ1VybCA9ICdodHRwOi8vMTI3LjAuMC4yOjQ3MjMvd2QvaHViL3N0YXR1cyc7XG4gICAgbGV0IGogPSBuZXcgSldQcm94eSgpO1xuICAgIGxldCBwcm94eVVybCA9IGouZ2V0VXJsRm9yUHJveHkoaW5jb21pbmdVcmwpO1xuICAgIHByb3h5VXJsLnNob3VsZC5lcXVhbCgnaHR0cDovL2xvY2FsaG9zdDo0NDQ0L3dkL2h1Yi9zdGF0dXMnKTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgdHJhbnNsYXRlIHRoZSBzY2hlbWUnLCAoKSA9PiB7XG4gICAgbGV0IGluY29taW5nVXJsID0gJ2h0dHA6Ly8xMjcuMC4wLjI6NDcyMy93ZC9odWIvc3RhdHVzJztcbiAgICBsZXQgaiA9IG5ldyBKV1Byb3h5KHtzY2hlbWU6ICdIVFRQUyd9KTtcbiAgICBsZXQgcHJveHlVcmwgPSBqLmdldFVybEZvclByb3h5KGluY29taW5nVXJsKTtcbiAgICBwcm94eVVybC5zaG91bGQuZXF1YWwoJ2h0dHBzOi8vbG9jYWxob3N0OjQ0NDQvd2QvaHViL3N0YXR1cycpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCB0cmFuc2xhdGUgdGhlIGJhc2UnLCAoKSA9PiB7XG4gICAgbGV0IGluY29taW5nVXJsID0gJ2h0dHA6Ly8xMjcuMC4wLjI6NDcyMy93ZC9odWIvc3RhdHVzJztcbiAgICBsZXQgaiA9IG5ldyBKV1Byb3h5KHtiYXNlOiAnJ30pO1xuICAgIGxldCBwcm94eVVybCA9IGouZ2V0VXJsRm9yUHJveHkoaW5jb21pbmdVcmwpO1xuICAgIHByb3h5VXJsLnNob3VsZC5lcXVhbCgnaHR0cDovL2xvY2FsaG9zdDo0NDQ0L3N0YXR1cycpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCB0cmFuc2xhdGUgdGhlIHNlc3Npb24gaWQnLCAoKSA9PiB7XG4gICAgbGV0IGluY29taW5nVXJsID0gJ2h0dHA6Ly8xMjcuMC4wLjI6NDcyMy93ZC9odWIvc2Vzc2lvbi9mb29iYXIvZWxlbWVudCc7XG4gICAgbGV0IGogPSBuZXcgSldQcm94eSh7c2Vzc2lvbklkOiAnYmFyYmF6J30pO1xuICAgIGxldCBwcm94eVVybCA9IGouZ2V0VXJsRm9yUHJveHkoaW5jb21pbmdVcmwpO1xuICAgIHByb3h5VXJsLnNob3VsZC5lcXVhbCgnaHR0cDovL2xvY2FsaG9zdDo0NDQ0L3dkL2h1Yi9zZXNzaW9uL2JhcmJhei9lbGVtZW50Jyk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGVycm9yIHdoZW4gdHJhbnNsYXRpbmcgc2Vzc2lvbiBjb21tYW5kcyB3aXRob3V0IHNlc3Npb24gaWQnLCAoKSA9PiB7XG4gICAgbGV0IGluY29taW5nVXJsID0gJ2h0dHA6Ly8xMjcuMC4wLjI6NDcyMy93ZC9odWIvc2Vzc2lvbi9mb29iYXIvZWxlbWVudCc7XG4gICAgbGV0IGogPSBuZXcgSldQcm94eSgpO1xuICAgICgoKSA9PiB7IGouZ2V0VXJsRm9yUHJveHkoaW5jb21pbmdVcmwpOyB9KS5zaG91bGQudGhyb3coJ3Nlc3Npb24gaWQnKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ3Byb3h5aW5nIHBhcnRpYWwgdXJscycsICgpID0+IHtcbiAgaXQoJ3Nob3VsZCBwcm94eSAvc3RhdHVzJywgKCkgPT4ge1xuICAgIGxldCBpbmNvbWluZ1VybCA9ICcvc3RhdHVzJztcbiAgICBsZXQgaiA9IG5ldyBKV1Byb3h5KCk7XG4gICAgbGV0IHByb3h5VXJsID0gai5nZXRVcmxGb3JQcm94eShpbmNvbWluZ1VybCk7XG4gICAgcHJveHlVcmwuc2hvdWxkLmVxdWFsKCdodHRwOi8vbG9jYWxob3N0OjQ0NDQvd2QvaHViL3N0YXR1cycpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBwcm94eSAvc2Vzc2lvbicsICgpID0+IHtcbiAgICBsZXQgaW5jb21pbmdVcmwgPSAnL3Nlc3Npb24nO1xuICAgIGxldCBqID0gbmV3IEpXUHJveHkoKTtcbiAgICBsZXQgcHJveHlVcmwgPSBqLmdldFVybEZvclByb3h5KGluY29taW5nVXJsKTtcbiAgICBwcm94eVVybC5zaG91bGQuZXF1YWwoJ2h0dHA6Ly9sb2NhbGhvc3Q6NDQ0NC93ZC9odWIvc2Vzc2lvbicpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBwcm94eSAvc2Vzc2lvbnMnLCAoKSA9PiB7XG4gICAgbGV0IGluY29taW5nVXJsID0gJy9zZXNzaW9ucyc7XG4gICAgbGV0IGogPSBuZXcgSldQcm94eSgpO1xuICAgIGxldCBwcm94eVVybCA9IGouZ2V0VXJsRm9yUHJveHkoaW5jb21pbmdVcmwpO1xuICAgIHByb3h5VXJsLnNob3VsZC5lcXVhbCgnaHR0cDovL2xvY2FsaG9zdDo0NDQ0L3dkL2h1Yi9zZXNzaW9ucycpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBwcm94eSBzZXNzaW9uIGNvbW1hbmRzIGJhc2VkIG9mZiAvc2Vzc2lvbicsICgpID0+IHtcbiAgICBsZXQgaW5jb21pbmdVcmwgPSAnL3Nlc3Npb24vZm9vYmFyL2VsZW1lbnQnO1xuICAgIGxldCBqID0gbmV3IEpXUHJveHkoe3Nlc3Npb25JZDogJ2JhcmJheid9KTtcbiAgICBsZXQgcHJveHlVcmwgPSBqLmdldFVybEZvclByb3h5KGluY29taW5nVXJsKTtcbiAgICBwcm94eVVybC5zaG91bGQuZXF1YWwoJ2h0dHA6Ly9sb2NhbGhvc3Q6NDQ0NC93ZC9odWIvc2Vzc2lvbi9iYXJiYXovZWxlbWVudCcpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBlcnJvciBzZXNzaW9uIGNvbW1hbmRzIGJhc2VkIG9mZiAvc2Vzc2lvbiB3aXRob3V0IHNlc3Npb24gaWQnLCAoKSA9PiB7XG4gICAgbGV0IGluY29taW5nVXJsID0gJy9zZXNzaW9uL2Zvb2Jhci9lbGVtZW50JztcbiAgICBsZXQgaiA9IG5ldyBKV1Byb3h5KCk7XG4gICAgKCgpID0+IHsgai5nZXRVcmxGb3JQcm94eShpbmNvbWluZ1VybCk7IH0pLnNob3VsZC50aHJvdygnc2Vzc2lvbiBpZCcpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBwcm94eSBzZXNzaW9uIGNvbW1hbmRzIGJhc2VkIG9mZiAvd2QvaHViJywgKCkgPT4ge1xuICAgIGxldCBpbmNvbWluZ1VybCA9ICcvd2QvaHViL3Nlc3Npb24vM2QwMDFkYjItNzk4Ny00MmE3LTk3NWQtOGQ1ZDUzMDQwODNmL3RpbWVvdXRzL2ltcGxpY2l0X3dhaXQnO1xuICAgIGxldCBqID0gbmV3IEpXUHJveHkoe3Nlc3Npb25JZDogJzEyMyd9KTtcbiAgICBsZXQgcHJveHlVcmwgPSBqLmdldFVybEZvclByb3h5KGluY29taW5nVXJsKTtcbiAgICBwcm94eVVybC5zaG91bGQuZXF1YWwoJ2h0dHA6Ly9sb2NhbGhvc3Q6NDQ0NC93ZC9odWIvc2Vzc2lvbi8xMjMvdGltZW91dHMvaW1wbGljaXRfd2FpdCcpO1xuXG4gIH0pO1xuICBpdCgnc2hvdWxkIHByb3h5IHNlc3Npb24gY29tbWFuZHMgYmFzZWQgb2ZmIC9zZXNzaW9uIGFzIFwiXCInLCAoKSA9PiB7XG4gICAgbGV0IGluY29taW5nVXJsID0gJyc7XG4gICAgbGV0IGogPSBuZXcgSldQcm94eSgpO1xuICAgICgoKSA9PiB7IGouZ2V0VXJsRm9yUHJveHkoaW5jb21pbmdVcmwpOyB9KS5zaG91bGQudGhyb3coJ3Nlc3Npb24gaWQnKTtcbiAgICBqID0gbmV3IEpXUHJveHkoe3Nlc3Npb25JZDogJzEyMyd9KTtcbiAgICBsZXQgcHJveHlVcmwgPSBqLmdldFVybEZvclByb3h5KGluY29taW5nVXJsKTtcbiAgICBwcm94eVVybC5zaG91bGQuZXF1YWwoJ2h0dHA6Ly9sb2NhbGhvc3Q6NDQ0NC93ZC9odWIvc2Vzc2lvbi8xMjMnKTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgcHJveHkgc2Vzc2lvbiBjb21tYW5kcyB3aXRob3V0IC9zZXNzaW9uJywgKCkgPT4ge1xuICAgIGxldCBpbmNvbWluZ1VybCA9ICcvZWxlbWVudCc7XG4gICAgbGV0IGogPSBuZXcgSldQcm94eSh7c2Vzc2lvbklkOiAnYmFyYmF6J30pO1xuICAgIGxldCBwcm94eVVybCA9IGouZ2V0VXJsRm9yUHJveHkoaW5jb21pbmdVcmwpO1xuICAgIHByb3h5VXJsLnNob3VsZC5lcXVhbCgnaHR0cDovL2xvY2FsaG9zdDo0NDQ0L3dkL2h1Yi9zZXNzaW9uL2JhcmJhei9lbGVtZW50Jyk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGVycm9yIHNlc3Npb24gY29tbWFuZHMgd2l0aG91dCAvc2Vzc2lvbiB3aXRob3V0IHNlc3Npb24gaWQnLCAoKSA9PiB7XG4gICAgbGV0IGluY29taW5nVXJsID0gJy9lbGVtZW50JztcbiAgICBsZXQgaiA9IG5ldyBKV1Byb3h5KCk7XG4gICAgKCgpID0+IHsgai5nZXRVcmxGb3JQcm94eShpbmNvbWluZ1VybCk7IH0pLnNob3VsZC50aHJvdygnc2Vzc2lvbiBpZCcpO1xuICB9KTtcbn0pO1xuIl19